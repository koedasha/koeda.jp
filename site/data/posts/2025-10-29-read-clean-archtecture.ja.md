---
date: 2025-10-29
title: クリーンアーキテクチャを読んだ
author: simaaaji
---

ボブおじさんのクリーンアーキテクチャを読んだ。
最近主にRailsの割と大きめのプロジェクトをやることが多くビジネスロジックの整理に課題を感じることがあり、アーキテクチャやSOLID、依存関係の整理についてよく考えていたのでちょうど良いタイミングだった。

書籍では、構造化プログラミングからプログラミングパラダイムの解説で始まり、モジュール分割の原則（SOLID）、モジュール結合・依存の原則の解説、そしてそれらを活用した集大成としてあの有名な4層アーキテクチャの解説を迎える。本の構成としてもとてもよくできていて、一人で共感しながら楽しく読み進めることができた。

他でもよく解説されているし本文にも書かれていることだけどクリーンアーキテクチャというのはボブおじさんがそれまでに提案された同様の階層型アーキテクチャの特徴をまとめた一提案であり、34章からも読み取れるように本書の内容の具体的な実践は個々の読者に委ねられていると考えて良さそう。

特に強調されているのはビジネスロジックからなる「アプリケーション」をフレームワークやDBなどの詳細から独立させるということ。これは長らくウェブフレームワークを使ってきた自分にはとても新鮮な視点だった。「32章フレームワークは詳細」で言われているように、フレームワークがどれほど優れたものだとしても究極的にはその作者や会社の問題を解決するためのもので、自分の問題に合わせてくれることはない。フレームワークを使うことは「一方的な結婚」であるということは意識しておきたい。

ビジネスロジックを何にも依存しない単純なオブジェクトで構成するのはとても良いと思った。これは、ORM等に縛られない柔軟な構成が可能なのでSOLIDなどの原則を適用したリファクタリングも容易そう。クラスやモジュールをどのように構成すべきかという指針が明確なのでAIとの相性も良さそう(これはあとあと検証していきたい)。

ところで本書ではビジネスロジック層を中心とした階層型アーキテクチャについては語ってくれているのだけどビジネスロジック層自体をどう形作れば良いのかということは語られていない。なのでActiveRecordなどで活かすにはどうすると良いのだろう。この辺りはDDDの出番なのかなぁ。これもよくある解説だけど4層アーキテクチャそのものよりもSOLID原則やモジュール結合に関する原則の方を参考にすべしという意見もよくわかるし、実践するならその方向性かも。

RailsだとMVCのMがビジネスロジックを扱うけど、ActiveRecordパターンであるがゆえにクリーンアーキテクチャが前提としているような単純なオブジェクトで構成することは難しい。そうすると、ARを単なるDBアクセス層として利用してビジネスロジックをPOROで構成するようなことが思いつくけど、そうするとRailsの高生産性要素の大部分を捨てることになりそう。

RailsでARを使う限りは「リッチなドメインモデル」という言葉で表されるようなモデル層を作ることを心がけていくと良いのかなぁと思っている。
参考） 37signalsブログの「Vanilla Rails is plenty」

そして、

> 最も重要なのは、クリーンアーキテクチャについて語ることだ。チームと話をしよう。開発者のコミュニティと話をしよう。品質はみんなの問題だ。アーキテクチャの善し悪しについて、合意を得ることが重要である。

とあとがきにあるように、チームでアーキテクチャについて話すことの重要さ。これは本当にそうだし、実践という意味では一番重要なことかもしれない。

余談ですがボブおじさんはrantと言って、[特定のトピックについて短く語るシリーズをXにアップしてる](https://x.com/search?q=rant%20from%3Aunclebobmartin)。これが結構面白い。
